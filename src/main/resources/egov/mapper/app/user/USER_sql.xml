<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="user">
    <!--사용자 목록조회-->
    <select id="retrieveUserList" parameterType="com.okestro.app.user.UserVo" resultType="com.okestro.app.user.UserVo">
        SELECT A.USER_EMAIL AS USER_EMAIL
             , A.USER_PASSWORD AS USER_PASSWORD
             , A.ROLE_CD AS ROLE_CD
             , A.DEL_YN AS DEL_YN
             , A.FRST_RGSR_DTL_DTTM AS FRST_RGSR_DTL_DTTM
             , A.LAST_CHNG_ID AS LAST_CHNG_ID
             , A.LAST_CHNG_DTL_DTTM AS LAST_CHNG_DTL_DTTM
             , B.CODE_KR AS CODE_KR
        FROM SCH_INCU.USER A
        LEFT OUTER JOIN SCH_INCU.CODE B
        ON A.ROLE_CD = B.CODE_VAL
        WHERE 1=1
        AND A.DEL_YN = 'N'
        <if test="userEmail != null and userEmail != ''">
            AND USER_EMAIL LIKE '%' || #{userEmail} || '%'
        </if>
        <if test="roleCd != null and roleCd != '' and roleCd != 'All'">
            AND ROLE_CD LIKE '%' || #{roleCd} || '%'
        </if>
        ORDER BY FRST_RGSR_DTL_DTTM DESC, USER_EMAIL
    </select>

    <!--사용자 상세조회-->
    <select id="retrieveUserDetail" parameterType="com.okestro.app.user.UserVo" resultType="com.okestro.app.user.UserVo">
        SELECT *
        FROM SCH_INCU.USER
        WHERE 1=1
        AND USER_EMAIL = #{userEmail}
    </select>

    <!-- 사용자 수정-->
    <update id="updateUser" parameterType="com.okestro.app.user.UserVo">
        UPDATE SCH_INCU.USER
        SET USER_PASSWORD = #{userPassword},
            ROLE_CD = #{roleCd}
        WHERE 1=1
        AND USER_EMAIL = #{userEmail}
    </update>

    <!-- 사용자 등록-->
    <insert id="registUser" parameterType="com.okestro.app.user.UserVo">
        INSERT INTO SCH_INCU.USER
        VALUES (
                #{userEmail},
                #{userPassword},
                #{roleCd},
                'N',
                'SYSTEM',
                CURRENT_TIMESTAMP,
                'SYSTEM',
                CURRENT_TIMESTAMP
               )
    </insert>

    <!-- 사용자 삭제-->
    <delete id="deleteUser" parameterType="string">
        UPDATE SCH_INCU.USER
        SET DEL_YN = 'Y'
        WHERE 1=1
        AND USER_EMAIL = #{userEmail}
    </delete>
</mapper>